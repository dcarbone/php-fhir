# php-fhir
Tools for creating PHP classes from the HL7 FHIR Specification

If you're looking  to use the classes generated by this library, you may want the
[php-fhir-generated](https://github.com/dcarbone/php-fhir-generated) repo instead.

# Documentation

Please refer to our wiki for the latest documentation: https://github.com/dcarbone/php-fhir/wiki

## Parsing Example

```php

require 'path to PHPFHIRResponseParserConfig.php';
require 'path to PHPFHIRResponseParser.php';

// build config
$config = new \YourConfiguredNamespace\PHPFHIRConfig([
    'registerAutoloader' => true, // use if you are not using Composer
    'libxmlOpts' => LIBXML_NONET | LIBXML_BIGLINES | LIBXML_PARSEHUGE | LIBXML_HTML_NOIMPLIED | LIBXML_HTML_NODEFDTD | LIBXML_NOXMLDECL // choose different libxml arguments if you want, ymmv.
    'rootXmlns' => 'https://hl7.org/fhir', // a specific root xmlns to use, if the source does not return one
    'overrideSourceXmlns' => true, // set this to true if you want the 'rootXmlns' value you defined to override any value seen from source 
]);

// build parser
$parser = new \YourConfiguredNamespace\PHPFHIRResponseParser($config);

// provide input, receive output.
$object = $parser->parse($yourResponseData);

```

# Serialization

## JSON Serialization

```php
$json = json_encode($object);
```

## XML Serialization

```php
// To get an instance of \XMLWriter...
$xw = $object->xmlSerialize(null, $yourConfigInstance);

// to get as XML string...
$xml = $xw->outputMemory(true);

// you can alternatively have the output written directly to a file:
$xw = new \YourConfiguredNamespace\PHPFHIRXmlWriter();
$xw->openUri('file:///some/directory/fhir-resource.xml');
$object->xmlSerialize($xw, $yourConfigInstance);
```

XML Serialization utilizes [XMLWriter](https://www.php.net/manual/en/book.xmlwriter.php).

# Testing

As part of class generation, a directory & namespace called `PHPFHIRTests` is created under the root namespace and
output directory.

## TODO

- Refactor template system to use Twig.
- Improve template loading and iteration system, too squirrely right now.
- Implement serialization abstraction, allowing for more flexible serialization options.
  - XMLReader / XMLParser pull or event parsing
  - Something like [pcrov/JSONReader](https://github.com/pcrov/JsonReader) for larger JSON responses
- Improved client implementation
  - Allow for persisting to, and parsing from, disk.

## Suggestions and help

